<html>
    <head>
        <title>Cartesian to 5Point Perspective</title>
        <style>
            #container {
		margin: 0 auto;
		text-align: center;
	    }
            canvas {
                border: 1px solid #000;
                margin: 10px;
		width: 40%;
            }
        </style>
        
    </head>
    <body>
	<div id="container">
            <canvas id="cart"></canvas>
            <canvas id="fivep"></canvas>
        </div>

	<script>
            cart  = document.getElementById('cart');
            fivep = document.getElementById('fivep');

	    var size = window.innerWidth * 0.4;
	    cart.width = cart.height = fivep.width = fivep.height = size;

	    cartCtx = cart.getContext('2d');
            fivepCtx = fivep.getContext('2d');
            cartCtx.translate(cart.width / 2, cart.height / 2);
            fivepCtx.translate(fivep.width / 2, fivep.height / 2);
            
            var ps = [{ x : 0,  y : 0  },
                      { x : 0,  y : 40 },
                      { x : 40, y : 40 },
                      { x : 40, y : 0  }];
            
            draw(ps);
            
            cart.addEventListener('mousemove', function(e) {
                var newps = [];
                var rect = cart.getBoundingClientRect();
                for(var i = 0; i < ps.length; i++) {
                    newps.push({ x : ps[i].x + e.clientX - (cart.width  / 2) - rect.left - 20,
                                 y : ps[i].y + e.clientY - (cart.height / 2) - rect.top -  20});
                }
                draw(newps);
            });
            
            function to5pp(p) {
                var r = (fivep.width / 2)
                x = p.x / r;
                y = p.y / r;
                x *= Math.sqrt(1 - (y * y));
                y *= Math.sqrt(1 - (x * x));
                x *= r;
                y *= r;
                return {x, y};
            };
                        
            function draw(ps) {
                cartCtx.clearRect(-cart.width / 2, -cart.height / 2, cart.width, cart.height);
                        
                cartCtx.beginPath();
                cartCtx.moveTo(ps[0].x, ps[0].y);
                for(var i = 0; i <= ps.length; i++) {
                    if (i === ps.length)
                         cartCtx.lineTo(ps[0].x, ps[0].y);
                    else
                         cartCtx.lineTo(ps[i].x, ps[i].y);
                }
                cartCtx.stroke();
                
                fivepCtx.clearRect(-fivep.width / 2, -fivep.height / 2, fivep.width, fivep.height);
                        
                fivepCtx.beginPath();
                var fp = to5pp(ps[0]);
                fivepCtx.moveTo(fp.x, fp.y);
                for(var i = 0; i <= ps.length; i++) {
                    if (i === ps.length)
                        fp = to5pp(ps[0]);
                    else
                        fp = to5pp(ps[i]);
                
                    fivepCtx.lineTo(fp.x, fp.y);
                }
                fivepCtx.stroke();   
            };
        </script>
    </body>
</html>
